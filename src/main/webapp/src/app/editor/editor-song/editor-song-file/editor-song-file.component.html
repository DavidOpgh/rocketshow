<div class="card-modal">
  <div class="card">
    <div class="card-header">
      {{ 'editor.edit-file' | translate }}
    </div>

    <div class="card-body">

      <div class="row">
        <div class="col-lg-6">

          <!-- Selected file -->
          <div class="card mb-3">
            <div class="card-body">
              <!-- No file selected -->
              <div *ngIf="!file?.name">
                {{ 'editor.no-file-selected' | translate }}
              </div>

              <!-- A file is selected -->
              <div *ngIf="file?.name">
                <i class="fa fa-fw" [ngClass]="file.getFontAwesomeIconClass()" aria-hidden="true"></i>
                {{ file?.name }}
              </div>
            </div>
          </div>

          <!-- Choose file -->
          <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" id="songs-tab" data-toggle="tab" href="#upload" role="tab">
                <i class="fa fa-upload" aria-hidden="true"></i> {{ 'editor.upload' | translate }}
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="setlists-tab" data-toggle="tab" href="#media-library" role="tab">
                <i class="fa fa-folder-o" aria-hidden="true"></i> {{ 'editor.media-library' | translate }}
              </a>
            </li>
          </ul>

          <div class="tab-content mb-3" id="myTabContent">

            <!-- Upload -->
            <div class="tab-pane fade show active" id="upload" role="tabpanel">
              <dropzone [config]="dropzoneConfig" [useDropzoneClass]="'false'" [message]="uploadMessage" (error)="onUploadError($event)"
                (success)="onUploadSuccess($event)"></dropzone>

              <div id="dz-preview-template" class="dz-preview dz-file-preview">
                <div class="dz-details">
                  <div class="dz-filename">
                    <span data-dz-name></span>
                  </div>
                  <div class="dz-size" data-dz-size></div>
                  <img data-dz-thumbnail />
                </div>
                <div class="dz-progress">
                  <span class="dz-upload" data-dz-uploadprogress></span>
                </div>
              </div>
            </div>

            <!-- Media library -->
            <div class="tab-pane fade" id="media-library" role="tabpanel">
              <input type="text" class="form-control input-block mb-3" id="searchSongList" placeholder="{{ 'editor.search-files' | translate }}"
                (input)="filterExistingFiles($event.target.value)">

              <div class="card" style="height: 300px; overflow-y: scroll;">
                <div class="card-body p-0">
                  <div class="list-group list-group-flush">
                    <a *ngFor="let existingFile of filteredExistingFiles" (click)="selectExistingFile(existingFile); false" href="#" class="list-group-item list-group-item-action flex-column align-items-start p-2"
                      [class.active]="file?.name == existingFile.name && file?.type == existingFile.type">

                      <p class="mb-0">
                        <i class="fa fa-fw" [ngClass]="existingFile.getFontAwesomeIconClass()" aria-hidden="true"></i>
                        {{ existingFile.name }}
                      </p>
                    </a>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <hr />

        <div class="col-lg-6">
          <div class="card">
            <div class="card-header">
              {{ 'editor.file-settings' | translate }}
            </div>

            <div class="card-body">

              <!-- Active (muted) -->
              <div class="form-group">
                <label class="col-form-label"></label>
                <label class="form-check-label">
                  <input type="checkbox" [ngModel]="!file?.active" (ngModelChange)="file.active = !$event" class="form-check-input"> {{ 'editor.mute' | translate }}
                </label>
              </div>

              <!-- Delay (offset) -->
              <div class="form-group">
                <label class="col-form-label" for="offsetMillis">{{ 'editor.offset-millis' | translate }}</label>

                <input type="text" class="form-control" [ngModel]="file?.offsetMillis" (ngModelChange)="file.offsetMillis = $event" id="offsetMillis"
                  placeholder="{{ 'editor.offset-placeholder' | translate }}">
              </div>

              <!-- Loop -->
              <div class="form-group">
                <label class="col-form-label"></label>
                <label class="form-check-label">
                  <input type="checkbox" [ngModel]="file?.loop" (ngModelChange)="file.loop = $event" class="form-check-input"> {{ 'editor.loop' | translate }}
                </label>
              </div>

              <!-- MIDI routing -->
              <div class="form-group" *ngIf="file?.type == 'MIDI'">
                <label class="col-form-label" for="offsetMillis">{{ 'editor.routing' | translate }}</label>

                <div class="list-group" [sortablejs]="file?.midiRoutingList" [sortablejsOptions]="{ onMove: sortMove }">
                  <div class="list-group-item" *ngFor="let routing of file?.midiRoutingList; let i = index">
                    <div class="row">
                      <div class="col-auto list-sort-handle my-auto" style="cursor: move; cursor: -webkit-grabbing;">
                        <i class="fa fa-bars" aria-hidden="true"></i>
                      </div>
                      <a href="#" class="col-auto flex-grow text-break-word my-auto pl-0" (click)="editRouting(i); false">
                        <div class="col col-auto pl-0">
                          <span *ngIf="routing.midiDestination == 'DMX'">
                            <i class="fa fa-lightbulb-o fa-fw" aria-hidden="true"></i> {{ 'editor.midi-destination-dmx' | translate }}</span>
                          <span *ngIf="routing.midiDestination == 'OUT_DEVICE'">
                            <i class="fa fa fa-sign-out fa-fw" aria-hidden="true"></i> {{ 'editor.midi-destination-device' | translate }}</span>
                          <span *ngIf="routing.midiDestination == 'REMOTE'">
                            <i class="fa fa-sitemap fa-fw" aria-hidden="true"></i> {{ 'editor.midi-destination-remote' | translate }}</span>
                        </div>
                      </a>
                      <div class="col-auto my-auto pl-0 pr-0">
                        <a class="text-danger float-right" href="#" role="button" (click)="deleteRouting(i); false">
                          <i class="fa fa-trash-o" aria-hidden="true"></i>
                        </a>
                      </div>
                      <div class="col-auto my-auto">
                        <a class="btn btn-secondary btn-sm" href="#" role="button" (click)="editRouting(i); false">...</a>
                      </div>
                    </div>
                  </div>
                  <a href="#" (click)="editRouting(0, true); false" class="no-sortjs list-group-item list-group-item-action text-center">
                    <i class="fa fa-plus" aria-hidden="true"></i> {{ 'editor.add-routing' | translate }}
                  </a>
                </div>

              </div>

            </div>
          </div>

        </div>
      </div>

    </div>

    <div class="card-footer">
      <div class="d-flex float-right">
        <a class="mr-3 my-auto" href="#" role="button" (click)="cancel(); false">
          {{ 'misc.cancel' | translate }}
        </a>
        <button type="button" class="btn btn-primary" [disabled]="!file?.name || file?.name.length === 0" (click)="ok(); false">
          {{ 'misc.ok' | translate }}
        </button>
      </div>
    </div>

  </div>
</div>